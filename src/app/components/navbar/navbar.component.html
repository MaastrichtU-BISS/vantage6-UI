<mat-toolbar>
  <button mat-icon-button *ngIf="isMobile" (click)="sidenav.toggle()">
    <mat-icon *ngIf="!sidenav.opened">menu</mat-icon>
    <mat-icon *ngIf="sidenav.opened">close</mat-icon>
  </button>
  <img class="logo" src="../assets/images/vantage6_logo.png" />
  <div class="actions">
    <button mat-stroked-button [routerLink]="['/settings/home']">
      Settings
    </button>
    <button
      mat-mini-fab
      color="primary"
      class="mat-elevation-z0"
      mat-button
      [matMenuTriggerFor]="menu"
    >
      <mat-icon>person</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <div class="name">{{ loggedin_user.username }}</div>
      <button mat-menu-item [routerLink]="['/profile']">Profile</button>
      <button mat-menu-item (click)="logout()">Logout</button>
    </mat-menu>
  </div>
</mat-toolbar>

<mat-sidenav-container
  class="sidenav-container"
  *ngIf="!useFullLayout; else fullLayout"
>
  <mat-sidenav #sidenav="matSidenav" [mode]="isMobile ? 'over' : 'side'">
    <!-- Link to home page -->
    <ng-container *ngIf="!isGlobalSetting">
      <button
        mat-button
        class="menu-button"
        routerLink="/home"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>home</mat-icon>
        <span>Home</span>
      </button>
    </ng-container>
    <ng-container *ngIf="isGlobalSetting">
      <button
        mat-button
        class="menu-button"
        routerLink="/settings/home"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>home</mat-icon>
        <span>Home</span>
      </button>
    </ng-container>
    <!-- Link to organization page -->
    <ng-container
      *ngIf="
        isGlobalSetting &&
        userPermission.hasPermission('view', 'organization', '*')
      "
    >
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/organization', loggedin_user.organization_id]"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>location_city</mat-icon>
        <span>Organization</span>
      </button>
    </ng-container>
    <ng-container
      *ngIf="
        isGlobalSetting &&
          userPermission.hasPermission('view', 'collaboration', 'global');
        else orgCollabLink
      "
    >
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/collaborations']"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>train</mat-icon>
        <span>Collaborations</span>
      </button>
    </ng-container>
    <ng-template #orgCollabLink>
      <div
        *ngIf="
          isGlobalSetting &&
          userPermission.hasPermission('view', 'collaboration', 'organization')
        "
      >
        <button
          mat-button
          class="menu-button"
          [routerLink]="['/collaborations', loggedin_user.organization_id]"
          routerLinkActive="menu-is-active"
        >
          <mat-icon>train</mat-icon>
          <span>Collaborations</span>
        </button>
      </div>
    </ng-template>

    <!-- Link to role page -->
    <ng-container
      *ngIf="
        isGlobalSetting &&
          userPermission.hasPermission('view', 'role', 'global');
        else orgRoleLink
      "
    >
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/roles']"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>roller_skating</mat-icon>
        <span>Roles</span>
      </button>
    </ng-container>
    <ng-template #orgRoleLink>
      <div
        *ngIf="
          isGlobalSetting &&
          userPermission.hasPermission('view', 'role', 'organization')
        "
      >
        <button
          mat-button
          class="menu-button"
          [routerLink]="['/roles', loggedin_user.organization_id]"
          routerLinkActive="menu-is-active"
        >
          <mat-icon>roller_skating</mat-icon>
          <span>Roles</span>
        </button>
      </div>
    </ng-template>

    <!-- Link to user page -->
    <ng-container
      *ngIf="
        isGlobalSetting &&
          userPermission.hasPermission('view', 'user', 'global');
        else orgUserLink
      "
    >
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/users']"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>people</mat-icon>
        <span>Users</span>
      </button>
    </ng-container>
    <ng-template #orgUserLink>
      <div
        *ngIf="
          isGlobalSetting &&
          userPermission.hasPermission('view', 'user', 'organization')
        "
      >
        <button
          mat-button
          class="menu-button"
          [routerLink]="['/users', loggedin_user.organization_id]"
          routerLinkActive="menu-is-active"
        >
          <mat-icon>people</mat-icon>
          <span>Users</span>
        </button>
      </div>
    </ng-template>

    <!-- Link to node page -->
    <ng-container
      *ngIf="
        !isGlobalSetting &&
          userPermission.hasPermission('view', 'node', 'global');
        else orgNodeLink
      "
    >
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/nodes']"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>data_object</mat-icon>
        <span>Nodes</span>
      </button>
    </ng-container>
    <ng-template #orgNodeLink>
      <div
        *ngIf="
          !isGlobalSetting &&
          userPermission.hasPermission('view', 'node', 'organization')
        "
      >
        <button
          mat-button
          class="menu-button"
          [routerLink]="['/nodes/org', loggedin_user.organization_id]"
          routerLinkActive="menu-is-active"
        >
          <mat-icon>data_object</mat-icon>
          <span>Nodes</span>
        </button>
      </div>
    </ng-template>

    <!-- Link to task page -->
    <ng-container
      *ngIf="
        userPermission.hasPermission('view', 'task', 'global');
        else orgTaskLink
      "
    >
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/tasks']"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>science</mat-icon>
        <span>Tasks</span>
      </button>
    </ng-container>
    <ng-template #orgTaskLink>
      <div *ngIf="userPermission.hasPermission('view', 'task', 'organization')">
        <button
          mat-button
          class="menu-button"
          [routerLink]="['/tasks/org', loggedin_user.organization_id]"
          routerLinkActive="menu-is-active"
        >
          <mat-icon>science</mat-icon>
          <span>Tasks</span>
        </button>
      </div>
    </ng-template>

    <ng-container *ngIf="userPermission.hasPermission('view', 'event', '*')">
      <mat-divider></mat-divider>
      <button
        mat-button
        class="menu-button"
        [routerLink]="['/status-messages']"
        routerLinkActive="menu-is-active"
      >
        <mat-icon>message</mat-icon>
        <span>Status updates</span>
      </button>
    </ng-container>

    <!-- TODO add help pages -->
    <!--
  <button mat-button class="menu-button">
    <mat-icon>help</mat-icon>
    <span>Help</span>
  </button> -->
  </mat-sidenav>
  <mat-sidenav-content>
    <div class="content">
      <div class="container-fluid">
        <router-outlet></router-outlet>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #fullLayout>
  <div class="container">
    <router-outlet></router-outlet>
  </div>
</ng-template>
